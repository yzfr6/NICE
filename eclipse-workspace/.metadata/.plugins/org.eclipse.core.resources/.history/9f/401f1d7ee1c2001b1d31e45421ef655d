package algorithm.objects;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import org.hl7.fhir.r4.model.Observation;
import org.hl7.fhir.r4.model.Quantity;
import org.hl7.fhir.r4.model.Quantity.QuantityComparator;

import FHIRResourceHelper.ResourceCreator;

public class SetGoal1 extends Entity {

	public Observation observation;
	public int db_id;

	public SetGoal1(int id, Observation observation, int db_id) {
		super(id);
		this.observation = observation;
		this.db_id = db_id;
	}

	public SetGoal1(int db_id, Connection c ) throws SQLException {
		super(0);
		PreparedStatement ps1 = c.prepareStatement("select * from algorithm_observation_decision_1 acd1 "
				+ "inner join observation o on o.id = acd1.observation_id "
				+ "inner join comparator c on acd1.comparator_id = c.id " + "inner join unit u on acd1.unit_id = u.id "
				+ "where acd1.id = ?");
		
		ps1.setInt(1, db_id);
		
		ResultSet rs1 = ps1.executeQuery();

		rs1.next();
		this.id = rs1.getInt("acd1.algorithm_entity_id");
		this.db_id = rs1.getInt("acd1.id");

		Observation observation = new Observation();
		observation.setCode(ResourceCreator.getCodeableConcept(rs1.getString("o.name"), ResourceCreator.LOINC_SYSTEM,
				rs1.getString("o.code")));
		observation.setId(rs1.getInt("c.id") + "");

		Quantity q = new Quantity();
		q.setComparator(QuantityComparator.valueOf(rs1.getString("c.name")));
		q.setUnit(rs1.getString("u.name"));
		q.setValue(rs1.getDouble("acd1.value"));
		observation.setValue(q);
		
		this.observation = observation;

	}
	
	public SetGoal1(Connection c, int entity_id) throws SQLException {
		super(entity_id);
		PreparedStatement ps1 = c.prepareStatement("select * from algorithm_observation_decision_1 acd1 "
				+ "inner join observation o on o.id = acd1.observation_id "
				+ "inner join comparator c on acd1.comparator_id = c.id " + "inner join unit u on acd1.unit_id = u.id "
				+ "where acd1.algorithm_entity_id = ?");
		ps1.setInt(1, entity_id);

		ResultSet rs1 = ps1.executeQuery();

		rs1.next();

		this.db_id = rs1.getInt("acd1.id");

		Observation observation = new Observation();
		observation.setCode(ResourceCreator.getCodeableConcept(rs1.getString("o.name"), ResourceCreator.LOINC_SYSTEM,
				rs1.getString("o.code")));
		observation.setId(rs1.getInt("c.id") + "");

		Quantity q = new Quantity();
		q.setComparator(QuantityComparator.valueOf(rs1.getString("c.name")));
		q.setUnit(rs1.getString("u.name"));
		q.setValue(rs1.getDouble("acd1.value"));
		observation.setValue(q);
		
		this.observation = observation;

	}

}
